#include QMK_KEYBOARD_H
#include "mousekey.h"

// Layer names
enum _layers {
  _L0,
  _L1,
  _L2,
  _L3,
  _L4
};

enum _keycodes {
  MMV_UL = SAFE_RANGE,
  MMV_UR,
  MMV_DL,
  MMV_DR
};

// Mouse key brief
#define MMV_UP KC_MS_UP
#define MMV_DN KC_MS_DOWN
#define MMV_LF KC_MS_LEFT
#define MMV_RT KC_MS_RIGHT
#define MMV_B1 KC_MS_BTN1
#define MMV_B2 KC_MS_BTN2
#define MMV_B3 KC_MS_BTN3

// Custom macros
#define L1_TOG      TG(_L1)                     // Layer 1
#define L2_SPC      LT(_L2, KC_SPC)             // Tap for Space, hold for L2
#define L3_ENT      LT(_L3, KC_ENT)             // Tap for Enter, hold for L3
#define L4_MOM      MO(_L4)                     // Layer 4

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

/* L0
 * ,---------------------------------------------------------------------------------------------------------------------------------------.
 * |  Esc  |   Q   |   W   |   E   |   R   |   T   |   Y   |   U   |   I   |   O   |   P   |  Del  | Bksp  |   7   |   8   |   9   |   x   |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |   Tab   |   A   |   S   |   D   |   F   |   G   |   H   |   J   |   K   |   L   |   ;   |    Enter    |   4   |   5   |   6   |   -   |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |    Shift    |   Z   |   X   |   C   |   V   |   B   |   N   |   M   |   ,   |   .   |   /   |  Shift  |   1   |   2   |   3   |   +   |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |   Ctl   |   Alt   |   GUI   |       L3/Enter      |     L2/Space    |   GUI   |  Alt  |  Fn   |  Ctl  |  L1T  |   0   |   .   |  Ent  |
 * `---------------------------------------------------------------------------------------------------------------------------------------'
 */
[_L0] = LAYOUT(
    KC_ESC, KC_Q,   KC_W,   KC_E,   KC_R,   KC_T,   KC_Y,   KC_U,   KC_I,   KC_O,   KC_P,   KC_DEL, KC_BSPC,KC_7,   KC_8,   KC_9,   KC_ASTR, \
    KC_TAB,   KC_A,   KC_S,   KC_D,   KC_F,   KC_G,   KC_H,   KC_J,   KC_K,   KC_L,   KC_SCLN,KC_QUOT,      KC_4,   KC_5,   KC_6,   KC_MINS, \
    KC_LSFT,      KC_Z,   KC_X,   KC_C,   KC_V,   KC_B,   KC_N,   KC_M,   KC_COMM,KC_DOT, KC_SLSH,KC_RSFT,  KC_1,   KC_2,   KC_3,   KC_PLUS, \
    KC_LCTL,  KC_LGUI,  KC_LALT,  L3_ENT,    L2_SPC,    L2_SPC,           KC_RALT,  KC_RGUI,L4_MOM, KC_RCTL,L1_TOG, KC_0,   KC_DOT, KC_ENT
),

/* L1
 * ,---------------------------------------------------------------------------------------------------------------------------------------.
 * |  Esc  |   Q   |   W   |   E   |   R   |   T   |   Y   |   U   |   I   |   O   |   P   |  Del  | Bksp  | Home  |  Up   | Pg Up |   x   |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |   Tab   |   A   |   S   |   D   |   F   |   G   |   H   |   J   |   K   |   L   |   ;   |    Enter    | Left  |   5   | Right |   -   |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |    Shift    |   Z   |   X   |   C   |   V   |   B   |   N   |   M   |   ,   |   .   |   /   |  Shift  |  End  | Down  | Pg Dn |   +   |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |   Ctl   |   Alt   |   GUI   |       L3/Enter      |     L2/Space    |   GUI   |  Alt  |  Fn   |  Ctl  |  L1T  |  Ins  |  Del  |  Ent  |
 * `---------------------------------------------------------------------------------------------------------------------------------------'
 */
[_L1] = LAYOUT(
    _______,_______,_______,_______,_______,_______,_______,_______,_______,_______,_______,_______,_______,KC_HOME,KC_UP,  KC_PGUP,_______, \
    _______,  _______,_______,_______,_______,_______,_______,_______,_______,_______,_______,_______,      KC_LEFT,XXXXXXX,KC_RGHT,_______, \
    _______,      _______,_______,_______,_______,_______,_______,_______,_______,_______,_______,_______,  KC_END, KC_DOWN,KC_PGDN,_______, \
    _______,  _______,  _______,  _______,   _______,   _______,          _______,  _______,_______,_______,_______,KC_INS, KC_DEL, _______
),

/* L2
 * ,---------------------------------------------------------------------------------------------------------------------------------------.
 * |   `   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   0   |  Del  | Bksp  |   7   |   8   |   9   |   x   |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |   Tab   |   -   |   =   |   [   |   ]   |   \   |   \   |   -   |   =   |   [   |   ]   |    Enter    |   4   |   5   |   6   |   -   |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |    Shift    |   Z   |   X   |   C   |   V   |   B   |   N   |   M   |   ,   |   .   |   /   |  Shift  |   1   |   2   |   3   |   +   |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |   Ctl   |   Alt   |   GUI   |       L3/Enter      |     L2/Space    |   GUI   |  Alt  |  Fn   |  Ctl  |  L1T  |   0   |   .   |  Ent  |
 * `---------------------------------------------------------------------------------------------------------------------------------------'
 */
[_L2] = LAYOUT(
    KC_GRV, KC_1,   KC_2,   KC_3,   KC_4,   KC_5,   KC_6,   KC_7,   KC_8,   KC_9,   KC_0,   _______,_______,_______,_______,_______,_______, \
    _______,  KC_MINS,KC_EQL, KC_LBRC,KC_RBRC,KC_BSLS,KC_BSLS,KC_MINS,KC_EQL, KC_LBRC,KC_RBRC,_______,      _______,_______,_______,_______, \
    _______,      _______,_______,_______,_______,_______,_______,_______,_______,_______,_______,_______,  _______,_______,_______,_______, \
    _______,  _______,  _______,  _______,   _______,   _______,          _______,  _______,_______,_______,_______,_______,_______,_______
),

/* L3
 * ,---------------------------------------------------------------------------------------------------------------------------------------.
 * |   ~   |   !   |   @   |   #   |   $   |   %   |   ^   |   &   |   *   |   (   |   )   |  Del  | Bksp  |   7   |   8   |   9   |   x   |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |   Tab   |   _   |   +   |   {   |   }   |   |   |   |   |   _   |   +   |   {   |   }   |    Enter    |   4   |   5   |   6   |   -   |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |    Shift    |   Z   |   X   |   C   |   V   |   B   |   N   |   M   |   ,   |   .   |   /   |  Shift  |   1   |   2   |   3   |   +   |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |   Ctl   |   Alt   |   GUI   |       L3/Enter      |     L2/Space    |   GUI   |  Alt  |  Fn   |  Ctl  |  L1T  |   0   |   .   |  Ent  |
 * `---------------------------------------------------------------------------------------------------------------------------------------'
 */
[_L3] = LAYOUT(
    KC_TILD,KC_EXLM,KC_AT,  KC_HASH,KC_DLR, KC_PERC,KC_CIRC,KC_AMPR,KC_ASTR,KC_LPRN,KC_RPRN,_______,_______,_______,_______,_______,_______, \
    _______,  KC_UNDS,KC_PLUS,KC_LCBR,KC_RCBR,KC_PIPE,KC_PIPE,KC_UNDS,KC_PLUS,KC_LCBR,KC_RCBR,_______,      _______,_______,_______,_______, \
    _______,      _______,_______,_______,_______,_______,_______,_______,_______,_______,_______,_______,  _______,_______,_______,_______, \
    _______,  _______,  _______,  _______,   _______,   _______,          _______,  _______,_______,_______,_______,_______,_______,_______
),

 /* L4
 * ,---------------------------------------------------------------------------------------------------------------------------------------.
 * |  Esc  |  F1   |  F2   |  F3   |  F4   |  F5   |  F6   |  F7   |  F8   |  F9   |  F10  |  F11  |  F12  | MS UL | MS UP | MS UR | MS B1 |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |   Tab   | PScr  | SLock | Pause |   F   |  App  |   H   |   J   |   K   |   L   |   ;   |    Enter    | MS LF | MS B1 | MS RT | MS B2 |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |    Shift    | RESET |Mac/Win|   C   |   V   |   B   |   N   |   M   | MPrev | MNext | MPlay |  Shift  | MS DL | MS DN | MS DR | MS B3 |
 * |---------------------------------------------------------------------------------------------------------------------------------------|
 * |   Ctl   |   Alt   |   GUI   |       L3/Enter      |     L2/Space    |   GUI   |  Alt  |  Fn   |  Ctl  | MS B1 | MS B2 | MS B3 |  Ent  |
 * `---------------------------------------------------------------------------------------------------------------------------------------'
 */
[_L4] = LAYOUT(
    KC_ESC, KC_F1,  KC_F2,  KC_F3,  KC_F4,  KC_F5,  KC_F6,  KC_F7,  KC_F8,  KC_F9,  KC_F10, KC_F11, KC_F12, MMV_UL, MMV_UP, MMV_UR, MMV_B1, \
    _______,  KC_PSCR,KC_SLCK,KC_PAUS,_______,KC_APP, _______,_______,_______,_______,_______,_______,      MMV_LF, MMV_B1, MMV_RT, MMV_B2, \
    _______,      RESET,  AG_TOGG,_______,_______,_______,_______,_______,KC_MPRV,KC_MNXT,KC_MPLY,_______,  MMV_DL, MMV_DN, MMV_DR, MMV_B3, \
    _______,  _______,  _______,  _______,   _______,   _______,          _______,  _______,_______,_______,MMV_B1, MMV_B2, MMV_B3, _______
)
};

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  switch (keycode) {
#ifdef MOUSEKEY_ENABLE
    case MMV_UL:
        if (record->event.pressed) {
            mousekey_on(KC_MS_UP);
            mousekey_on(KC_MS_LEFT);
        } else {
            mousekey_off(KC_MS_UP);
            mousekey_off(KC_MS_LEFT);
        }
        return false;
    case MMV_UR:
        if (record->event.pressed) {
            mousekey_on(KC_MS_UP);
            mousekey_on(KC_MS_RIGHT);
        } else {
            mousekey_off(KC_MS_UP);
            mousekey_off(KC_MS_RIGHT);
        }
        return false;
    case MMV_DL:
        if (record->event.pressed) {
            mousekey_on(KC_MS_DOWN);
            mousekey_on(KC_MS_LEFT);
        } else {
            mousekey_off(KC_MS_DOWN);
            mousekey_off(KC_MS_LEFT);
        }
        return false;
    case MMV_DR:
        if (record->event.pressed) {
            mousekey_on(KC_MS_DOWN);
            mousekey_on(KC_MS_RIGHT);
        } else {
            mousekey_off(KC_MS_DOWN);
            mousekey_off(KC_MS_RIGHT);
        }
        return false;
#endif
  }
  return true;
}
